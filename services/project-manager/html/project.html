<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Management</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-300">
  <div class="container mx-auto px-4 py-5">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Project Management Dashboard</h1>
    
    <!-- Project Section -->
    <div id="projects" class="bg-white shadow overflow-hidden sm:rounded-md p-4 mb-6"></div>

    <!-- Add more projects here -->
    <form id="createProjectForm" class="flex justify-center">
      <input type="text" id="projectName" class="border border-gray-400 rounded-l px-4 py-2" placeholder="Enter Project Name">
      <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r">Create Project</button>
    </form>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    // Fetch and display projects
    function fetchProjects() {
      $.ajax({
        url: "http://localhost:8080/projects",
        type: "GET",
        success: function(data) {
          displayProjects(data);
        },
        error: function(error) {
          console.error("Error fetching projects:", error);
        }
      });
    }

    function displayProjects(projects) {
      var projectsDiv = document.getElementById("projects");
      projectsDiv.innerHTML = "";

      projects.forEach(function(project) {
        var projectDiv = document.createElement("div");
        projectDiv.innerHTML = "<h2>" + project.name + "</h2>";

        var createTaskForm = document.createElement("form");
        createTaskForm.innerHTML = '<input type="hidden" name="projectId" value="' + project.id + '">' +
          '<input type="text" name="name" placeholder="Task Name" class="border border-gray-400 rounded-l px-4 py-2">' +
          '<button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-r">Create Task</button>';

        createTaskForm.addEventListener("submit", function(e) {
          e.preventDefault();
          createTask(project.id);
        });

        projectDiv.appendChild(createTaskForm);
        projectsDiv.appendChild(projectDiv);
      });
    }

    function createProject() {
      var projectName = document.getElementById("projectName").value;
      $.ajax({
        url: "http://localhost:8080/createProject",
        type: "POST",
        data: { name: projectName },
        success: function() {
          fetchProjects();
          document.getElementById("projectName").value = "";
        },
        error: function(error) {
          console.error("Error creating project:", error);
        }
      });
    }

    function createTask(projectId) {
      var taskName = prompt("Enter Task Name:");
      if (!taskName) return;

      $.ajax({
        url: "http://localhost:8080/createTask",
        type: "POST",
        data: { name: taskName, projectId: projectId },
        success: function() {
          fetchProjects();
        },
        error: function(error) {
          console.error("Error creating task:", error);
        }
      });
    }

    // Fetch projects on page load
    fetchProjects();

    // Event listener for create project form submission
    document.getElementById("createProjectForm").addEventListener("submit", function(e) {
      e.preventDefault();
      createProject();
    });
  </script>
</body>
</html>
